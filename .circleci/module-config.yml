version: 2.1

parameters:
  changed-module:
    default: "some-value"
    type: string
  files-changed:
    type: string
    default: ''
  frontend:
    type: boolean
    default: false
  backend:
    type: boolean
    default: false
  infra:
    type: boolean
    default: false
  run-all:
    type: boolean
    default: false

jobs:
  failed-status-job:
    docker:
      - image: cimg/base:stable
    steps:
      - run: echo "hello!"
      - run: exit 1
      
  success-status-job:
    type: no-op
    
  run_job:
    docker:
      - image: cimg/base:stable
    parameters:
      module:
        type: string
    steps:
      - run: echo <<parameters.module>>
      - run: exit 1

workflows:
  build:
    jobs:
      - run_job:
           name: "run_job-<<pipeline.parameters.changed-module>>"
           module: <<pipeline.parameters.changed-module>>
           filters: pipeline.trigger.source == "api"
      - success-status-job:
           name: status-job
           requires:
              - "run_job-<<pipeline.parameters.changed-module>>":
                    - success
      - failed-status-job:
           name: status-job
           requires:
              - "run_job-<<pipeline.parameters.changed-module>>":
                    - failed
